package com.climawan.comp6844001.pertemuan5.hakubank.activities;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.climawan.comp6844001.pertemuan5.hakubank.R;
import com.climawan.comp6844001.pertemuan5.hakubank.services.AuthEncodingService;

public class LoginActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_login);

        loginOnClickListener = new LoginOnClickListener();
        activateOnClickListener = new ActivateOnClickListener();

        btnLogin = findViewById(R.id.btn_login);
        btnActivate = findViewById(R.id.btn_activate);
        etPasscode = findViewById(R.id.et_passcode);
    }

    @Override
    protected void onStart() {
        super.onStart();

        setListeners();
    }

    private void setListeners() {
        btnLogin.setOnClickListener(loginOnClickListener);
        btnActivate.setOnClickListener(activateOnClickListener);
    }

    private class LoginOnClickListener implements View.OnClickListener {

        @Override
        public void onClick(View v) {
            SharedPreferences preferences = LoginActivity.this.getSharedPreferences(
                    getString(R.string.sp__storage_id), MODE_PRIVATE
            );

            String savedPasscode = preferences.getString(getString(R.string.sp__passcode_id), "null");
            String enteredPasscode = LoginActivity.this.etPasscode.getText().toString();
            enteredPasscode = AuthEncodingService.encode(enteredPasscode);
            Log.i("LoginActivity", "Compare entered passcode with saved password in shared pref...");
            if (savedPasscode.equals("null")) {
                Toast.makeText(LoginActivity.this, getString(R.string.login_activity__activate_alert_text), Toast.LENGTH_SHORT).show();
                return;
            } else if (!savedPasscode.equals(enteredPasscode)) {
                Toast.makeText(LoginActivity.this, getString(R.string.login_activity__wrong_passcode_alert_text), Toast.LENGTH_SHORT).show();
                return;
            }
            Log.i("LoginActivity", "Correct passcode, redirect to HomeActivity...");

            Intent intent = new Intent(LoginActivity.this, HomeActivity.class);
            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
            startActivity(intent);
        }
    }

    private class ActivateOnClickListener implements View.OnClickListener {

        @Override
        public void onClick(View v) {
            startActivity(
                    new Intent(LoginActivity.this.getApplicationContext(), ActivateMBankingActivity.class)
            );
        }
    }

    private LoginOnClickListener loginOnClickListener;
    private ActivateOnClickListener activateOnClickListener;

    private Button btnLogin;
    private Button btnActivate;
    private EditText etPasscode;
}