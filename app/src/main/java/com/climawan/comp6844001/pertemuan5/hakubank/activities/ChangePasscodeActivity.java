package com.climawan.comp6844001.pertemuan5.hakubank.activities;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.climawan.comp6844001.pertemuan5.hakubank.R;
import com.climawan.comp6844001.pertemuan5.hakubank.services.AuthEncodingService;

public class ChangePasscodeActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_change_passcode);

        changeOnClickListener = new ChangeOnClickListener();
        etPasscode = findViewById(R.id.et_passcode);
        btnChange = findViewById(R.id.btn_change);

        passcode = "";
    }

    @Override
    protected void onStart() {
        super.onStart();

        btnChange.setOnClickListener(changeOnClickListener);
    }

    private class ChangeOnClickListener implements View.OnClickListener {

        @Override
        public void onClick(View v) {
            passcode = ChangePasscodeActivity.this.etPasscode.getText().toString();

            if (!this.validatePasscode()) return;

            this.saveUpdatedPasscode();

            Toast.makeText(ChangePasscodeActivity.this, "Success change passcode!", Toast.LENGTH_SHORT).show();

            Intent intent = new Intent(ChangePasscodeActivity.this, HomeActivity.class);
            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
            startActivity(intent);
        }

        private boolean saveUpdatedPasscode() {
            String encodedPasscode = AuthEncodingService.encode(
                    ChangePasscodeActivity.this.passcode
            );

            SharedPreferences preferences = ChangePasscodeActivity.this.getSharedPreferences(
                    getString(R.string.sp__storage_id), Context.MODE_PRIVATE
            );
            SharedPreferences.Editor editor = preferences.edit();
            editor.putString(
                    getString(R.string.sp__passcode_id),
                    encodedPasscode
            );
            editor.apply();

            return true;
        }

        private boolean validatePasscode() {
            if (ChangePasscodeActivity.this.passcode.length() != 6) {
                Toast.makeText(
                        ChangePasscodeActivity.this,
                        getString(R.string.activate_m_banking_activity__passcode_length_alert_text),
                        Toast.LENGTH_SHORT
                ).show();
                return false;
            }

            return true;
        }
    }

    private ChangeOnClickListener changeOnClickListener;

    private EditText etPasscode;
    private Button btnChange;

    private String passcode;
}