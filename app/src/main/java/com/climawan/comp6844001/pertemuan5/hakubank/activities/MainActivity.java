package com.climawan.comp6844001.pertemuan5.hakubank.activities;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.widget.Toast;

import com.climawan.comp6844001.pertemuan5.hakubank.R;
import com.climawan.comp6844001.pertemuan5.hakubank.database.daos.AccountDao;
import com.climawan.comp6844001.pertemuan5.hakubank.database.entities.Account;
import com.climawan.comp6844001.pertemuan5.hakubank.database.implementation.AppDatabaseImpl;
import com.climawan.comp6844001.pertemuan5.hakubank.services.RootCheckService;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        accountDao = AppDatabaseImpl.getInstance(MainActivity.this).accountDao();

        rootCheckService = new RootCheckService(this.getApplicationContext());
    }

    @Override
    protected void onStart() {
        super.onStart();

        if (rootCheckService.checkRoot()) {
            Toast.makeText(this, getString(R.string.main_activity__root_alert_text), Toast.LENGTH_SHORT).show();
            finishAndRemoveTask();
            return;
        }

        initializeDatabase();

        startActivity(
                new Intent(this, LoginActivity.class)
        );
    }

    private void initializeDatabase() {
        Account newAccount = new Account();
        newAccount.accountNumber = "5267711231";
        newAccount.balance = 50000;

        if (accountDao.getSpecific(newAccount.accountNumber) == null)
            accountDao.insert(newAccount);

        newAccount = new Account();
        newAccount.accountNumber = "1001129985";
        newAccount.balance = 20000;

        if (accountDao.getSpecific(newAccount.accountNumber) == null)
            accountDao.insert(newAccount);

        newAccount = new Account();
        newAccount.accountNumber = "7035216692";
        newAccount.balance = 100000;

        if (accountDao.getSpecific(newAccount.accountNumber) == null)
            accountDao.insert(newAccount);
    }

    private AccountDao accountDao;

    private RootCheckService rootCheckService;
}